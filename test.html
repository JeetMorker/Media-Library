<!DOCTYPE html>
<html>
   <head>
      <title>Comment Section</title>
      <!--This is the css for the webpage. -->
      <style>
         body {
         font-family: Arial, sans-serif;
         margin: 20px;
         }
         h1 {
         text-align: center;
         }
         form {
         max-width: 500px;
         margin: 0 auto;
         padding: 20px;
         background-color: #f2f2f2;
         border-radius: 5px;
         }
         input[type=text], input[type=email] {
         width: 100%;
         padding: 12px 20px;
         margin: 8px 0;
         display: inline-block;
         border: 1px solid #ccc;
         border-radius: 4px;
         box-sizing: border-box;
         }
         textarea {
         width: 100%;
         height: 150px;
         padding: 12px 20px;
         box-sizing: border-box;
         border: 1px solid #ccc;
         border-radius: 4px;
         resize: vertical;
         }
         button {
         background-color: #4CAF50;
         color: white;
         padding: 14px 20px;
         margin: 8px 0;
         border: none;
         border-radius: 4px;
         cursor: pointer;
         }
         button:hover {
         background-color: #45a049;
         }
      </style>
   </head>
   <body>
      <!--this is the html code. contains a form for user input. takes in name, email, and comments-->
      <h1>Comment Section</h1>
      <form>
         <label for="name">Name:</label>
         <input type="text" id="name" name="name" required>
         <label for="email">Email:</label>
         <input type="email" id="email" name="email" required>
         <label for="comment">Comment:</label>
         <textarea id="comment" name="comment" required></textarea>
         <button type="submit" id="AddBtn">Submit</button>
      </form>
      <!-- this part is where the comments are displayed-->
      <div id = "UserDiv">
      </div>
      <script type="module">
         // Import the functions you need from the SDKs you need
         import { initializeApp } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-app.js";
         import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.10.0/firebase-analytics.js";
         import{getDatabase,ref,child,get,set,update,remove} from "https://www.gstatic.com/firebasejs/10.10.0/firebase-database.js";
         // TODO: Add SDKs for Firebase products that you want to use
         // https://firebase.google.com/docs/web/setup#available-libraries
         
         // Your web app's Firebase configuration
         // For Firebase JS SDK v7.20.0 and later, measurementId is optional
         const firebaseConfig = {
           apiKey: "AIzaSyCAoLUSafn3HFjl__psH1L7iHwNHtyOhpE",
           authDomain: "fir-ec626.firebaseapp.com",
           projectId: "fir-ec626",
           storageBucket: "fir-ec626.appspot.com",
           messagingSenderId: "601974069703",
           appId: "1:601974069703:web:476d6a4d8341c5afe2a1e2",
           measurementId: "G-D9P08JJTEV"
         };
         
         // Initialize Firebase and the realtime storage 
         const app = initializeApp(firebaseConfig);
         const db = getDatabase();
         
         let UserDiv = document.getElementById("UserDiv")
         let stdno = 1;
         //takes user input and store it in a variable for later use. 
         let name = document.getElementById("name");
         let email = document.getElementById("email");
         let comment = document.getElementById("comment");
         // this function add data into the firebase storage
         
         function AddData(){
             set(ref(db,'userSet/' + document.getElementById("name").value),{
                 name: name.value,
                 email:email.value,
                 comment: comment.value
             }).then(()=>{
                 // if data is added successfully, the function RetData will be called  
                 alert("data added");
                 RetData();
             }).catch(()=>{
                 // if failed to add. there will be a popup message saying error. can also check console for error. 
                 alert("error");
                 console.log(error);
             })
         }
         
         //this function is for retrieving data 
         function RetData(){
             const dbref = ref(db);
             get(child(dbref,"userSet/")).then((user)=>{
                //call the function "adduser" for each set of data in the storage. 
                user.forEach(std =>{
                 adduser(std);
                });
             })
             .catch((error)=>{
                 alert("unsuccessful");
                 console.log(error);
             })
         }
         
         //this function will delete data from the database 
         function DeleteData(){
             set(ref(db,'userSet/' + name.value)).then(()=>{
                 alert("data removed");
             }).catch(()=>{
                 alert("error");
                 console.log(error);
             })
         }

         // this function display user input on the webpage 
         function adduser(std){
         let key =std.key;
         let value = std.val();
         
         let name = document.createElement("li");
         let email = document.createElement("li");
         let comment = document.createElement("li");
         
         name.innerHTML = "Name: " + value.name;
         email.innerHTML = "Emai: " + value.email;
         comment.innerHTML = "comment : " + value.comment;
         
         let ul = document.createElement('ul');
         ul.append(name , email, comment);
         UserDiv.append(ul);
         stdno++;

         }
         //trigger the AddData function will a button is clicked
         AddBtn.addEventListener('click',AddData);
         //when the webpage reloads, the function RetData will be call
         window.addEventListener('load', RetData);
      </script>
   </body>
</html>